<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>UniMatcher</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ===== FIX: Prevent navbar from inheriting monospace styles ===== */
        nav, nav * {
            font-family: inherit !important;
            font-style: inherit !important;
            font-weight: inherit !important;
        }

        /* ===== ORIGINAL STYLES — restored fully ===== */
        form#gradesForm {
            position: relative;
            display: block;
            padding: 2.2rem;
            background: linear-gradient(
                14deg,
                rgba(2, 0, 36, 0.8) 0%,
                rgba(24, 24, 65, 0.7) 66%,
                rgb(20, 76, 99) 100%
            ),
            radial-gradient(
                circle,
                rgba(2, 0, 36, 0.5) 0%,
                rgba(32, 15, 53, 0.2) 65%,
                rgba(14, 29, 28, 0.9) 100%
            );
            border: 2px solid #fff;
            box-shadow: rgba(0, 212, 255, 0.6) 0px 0px 50px -15px;
            overflow: hidden;
            z-index: +1;
            border-radius: 8px;
            font-family: monospace;
        }

        .input-container { position: relative; }

        .input-container input,
        form button,
        #gradesForm input,
        #gradesForm select,
        #gradesForm textarea {
            outline: none;
            border: 2px solid #ffffff;
            margin: 8px 0;
            font-family: monospace;
            border-radius: 4px;
        }

        .input-container input,
        #gradesForm input {
            background-color: #fff;
            color: #243949;
            padding: 6px;
            font-size: 0.875rem;
            line-height: 1.25rem;
            width: 100%;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .input-container input,
        #gradesForm input {
            display: inline;
            width: 49%;
        }

        .submit {
            position: relative;
            display: block;
            padding: 8px;
            background: linear-gradient(90deg, #243949 0%, #517fa4 100%);
            color: #ffffff;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5);
            font-size: 0.875rem;
            line-height: 1.25rem;
            font-weight: 500;
            width: 100%;
            text-transform: uppercase;
            overflow: hidden;
        }

        .submit:hover {
            transition: all 0.2s ease-out;
            box-shadow: 4px 5px 17px -4px #ffffff;
            cursor: pointer;
        }

        .submit::before {
            content: "";
            display: block;
            width: 0px;
            height: 85%;
            position: absolute;
            top: 50%;
            left: 0%;
            opacity: 0;
            background: #fff;
            box-shadow: 0 0 50px 30px #fff;
            transform: skewX(-20deg);
        }

        /* Header & Title */
        .form-title {
            font-size: 1.25rem;
            line-height: 1.75rem;
            font-weight: 600;
            text-align: center;
            color: #fff;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.7);
        }

        .signup-link a {
            color: #fff;
            text-decoration: none;
        }

        .signup-link a:hover { text-decoration: underline; }
    </style>
</head>
<body class="bg-gray-900 text-white">

<div th:insert="~{navbar :: navbar}"></div>

<div class="max-w-6xl mx-auto p-8">
    <h1 class="text-4xl font-extrabold mb-6">
        Bine ai venit, <span th:text="${student.name}">Student</span>
    </h1>

    <form th:action="@{/account/grades}" method="post" id="gradesForm" class="mt-6">

        <!-- NOTE -->
        <section>
            <h2 class="form-title mb-2">Notele tale</h2>
            <div id="notes">
                <div th:each="entry : ${student.grades}" class="input-container">
                    <input type="text" th:value="${entry.key}" readonly/>
                    <input type="number" step="0.01" min="0" max="10"
                           th:name="'grades[' + ${entry.key} + ']'"
                           th:value="${entry.value}"/>
                </div>
            </div>

            <div class="flex gap-2 mt-4">
                <input type="text" id="newSubject" placeholder="Materie nouă" />
                <input type="number" id="newGrade" step="0.01" min="0" max="10" placeholder="Notă" />
                <button type="button" onclick="addNewSubject()" class="submit">
                    ➕ Adaugă
                </button>
            </div>
        </section>

        <!-- INTERESE -->
        <section>
            <h2 class="form-title mt-6 mb-2">Interesele tale</h2>
            <input type="text" name="interestsInput" th:value="${interests}" placeholder="ex: IT, matematică, robotică" />
            <input type="text" name="newInterest" placeholder="ex: inteligență artificială" class="mt-2"/>
        </section>

        <button type="submit" class="submit mt-4">
            Salvează datele
        </button>
    </form>

    <button type="button" onclick="generateRecommendations()" class="submit mt-4 bg-green-600 hover:bg-green-700">
        Generează recomandări
    </button>

    <form id="recommendationsForm" th:action="@{/recommendations}" method="post" class="hidden">
        <input type="hidden" name="algorithm" value="cosine"/>
        <input type="hidden" name="name" th:value="${student.name}"/>
    </form>
</div>

<script>
    function addNewSubject() {
        const subjectInput = document.getElementById('newSubject');
        const gradeInput = document.getElementById('newGrade');
        const container = document.getElementById('notes');

        const subject = subjectInput.value.trim();
        const grade = gradeInput.value.trim();

        if (!subject || !grade) {
            alert("Introduceți materia și nota!");
            return;
        }

        const existing = container.querySelector(`[name='grades[${subject}]']`);
        if (existing) {
            existing.value = grade;
        } else {
            const div = document.createElement('div');
            div.className = 'input-container';
            div.innerHTML = `
                <input type="text" value="${subject}" readonly/>
                <input type="number" step="0.01" min="0" max="10" name="grades[${subject}]" value="${grade}"/>
            `;
            container.appendChild(div);
        }

        subjectInput.value = '';
        gradeInput.value = '';
    }

    function generateRecommendations() {
        const form = document.getElementById('recommendationsForm');

        form.querySelectorAll("input[name^='gradesInput'], input[name='interestsInput']").forEach(el => el.remove());

        document.querySelectorAll("#notes input[name^='grades[']").forEach(input => {
            const subject = input.name.match(/grades\[(.*)\]/)[1];
            const grade = input.value;
            if (grade && !isNaN(grade)) {
                const hidden = document.createElement("input");
                hidden.type = "hidden";
                hidden.name = `gradesInput[${subject}]`;
                hidden.value = grade;
                form.appendChild(hidden);
            }
        });

        const interestsInput = document.querySelector("input[name='interestsInput']");
        if (interestsInput && interestsInput.value.trim() !== "") {
            const hiddenInterests = document.createElement("input");
            hiddenInterests.type = "hidden";
            hiddenInterests.name = "interestsInput";
            hiddenInterests.value = interestsInput.value;
            form.appendChild(hiddenInterests);
        }

        form.submit();
    }
</script>

</body>
</html>
